"use strict";(()=>{var i=(r,e)=>{if(!r)throw new Error(e??"Failed assertion.")};var v=r=>{throw new Error(r??"Reached unreachable code.")};var D={bundle:async r=>{try{return await syscall("artifact_bundle",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},get:async r=>{try{return await syscall("artifact_get",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},F={decode:r=>{try{return syscall("base64_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("base64_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},z={bytes:async r=>{try{return await syscall("blob_bytes",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},new:async r=>{try{return await syscall("blob_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},text:async r=>{try{return await syscall("blob_text",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var ee={new:async r=>{try{return await syscall("command_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},te={new:async r=>{try{return await syscall("directory_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},re={new:async r=>{try{return await syscall("file_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},Q={new:async r=>{try{return await syscall("function_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var B={decode:r=>{try{return syscall("hex_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("hex_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},N={decode:r=>{try{return syscall("json_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("json_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},se=r=>{try{return syscall("log",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},H={get:async r=>{try{return await syscall("operation_get",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},run:async r=>{try{return await syscall("operation_run",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},ae={new:async r=>{try{return await syscall("resource_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},ne={new:async r=>{try{return await syscall("symlink_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},_={decode:r=>{try{return syscall("toml_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("toml_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},$={decode:r=>{try{return syscall("utf8_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("utf8_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},M={decode:r=>{try{return syscall("yaml_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("yaml_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var Ae;(t=>(t.decode=a=>F.decode(a),t.encode=a=>F.encode(a)))(Ae||={});var we;(t=>(t.decode=a=>B.decode(a),t.encode=a=>B.encode(a)))(we||={});var X;(t=>(t.decode=a=>N.decode(a),t.encode=a=>N.encode(a)))(X||={});var xe;(t=>(t.decode=a=>_.decode(a),t.encode=a=>_.encode(a)))(xe||={});var ke;(t=>(t.decode=a=>$.decode(a),t.encode=a=>$.encode(a)))(ke||={});var Se;(t=>(t.decode=a=>M.decode(a),t.encode=a=>M.encode(a)))(Se||={});var K={get(){return i(this.value),this.value}};var oe=(...r)=>p.new(...r),k=(...r)=>g.new(...r),p=class{#e;#t;static new(...e){let t=new p,a=n=>{if(typeof n=="string")for(let o of n.split("/"))o===""||o==="."||(o===".."?t=t.parent():t.#t.push(o));else if(n instanceof p){for(let o=0;o<n.#e;o++)t.parent();t.#t.join(n.#t)}else if(n instanceof g)t.#t.join(n);else if(n instanceof Array)for(let o of n)a(o)};for(let n of e)a(n);return t}constructor(e){this.#e=e?.parents??0,this.#t=e?.subpath??new g}static is(e){return e instanceof p}toSyscall(){return this.toString()}static fromSyscall(e){return p.new(e)}isEmpty(){return this.#e==0&&this.#t.isEmpty()}parents(){return this.#e}subpath(){return this.#t}parent(){return this.#t.isEmpty()?this.#e+=1:this.#t.pop(),this}join(e){e=p.new(e);for(let t=0;t<e.#e;t++)this.parent();return this.#t.join(e.#t),this}extension(){return this.#t.extension()}toSubpath(){if(this.#e>0)throw new Error("Cannot convert to subpath.");return this.#t}toString(){let e="";for(let t=0;t<this.#e;t++)e+="../";return e+=this.#t.toString(),e}};(e=>{let r;(o=>(o.is=s=>s===void 0||typeof s=="string"||s instanceof g||s instanceof e||s instanceof Array&&s.every(e.Arg.is),o.expect=s=>(i((0,o.is)(s)),s),o.assert=s=>{i((0,o.is)(s))}))(r=e.Arg||={})})(p||={});var g=class{#e;static new(...e){return p.new(...e).toSubpath()}constructor(e){this.#e=e??[]}static is(e){return e instanceof g}toSyscall(){return this.toString()}static fromSyscall(e){return k(e)}components(){return[...this.#e]}isEmpty(){return this.#e.length==0}join(e){return this.#e.push(...e.#e),this}push(e){this.#e.push(e)}pop(){this.#e.pop()}extension(){return this.#e.at(-1)?.split(".").at(-1)}toRelpath(){return p.new(this)}toString(){return this.#e.join("/")}};var L=async r=>await y.new(r),y=class{#e;#t;#r;#s;static async new(e){let t=await A(e),a,n,o;if(d.Arg.is(t))a=await I(t),n=!1,o=[];else{if(y.is(t))return t;a=await I(t.blob),n=t.executable??!1,o=t.references??[]}return y.fromSyscall(await re.new({blob:a.toSyscall(),executable:n,references:o.map(s=>m.toSyscall(s))}))}constructor(e){this.#e=e.hash,this.#t=e.blob,this.#r=e.executable,this.#s=e.references}static is(e){return e instanceof y}static expect(e){return i(y.is(e)),e}static assert(e){i(y.is(e))}toSyscall(){return{hash:this.#e,blob:this.#t.toSyscall(),executable:this.#r,references:this.#s}}static fromSyscall(e){return new y({hash:e.hash,blob:d.fromSyscall(e.blob),executable:e.executable,references:e.references})}hash(){return this.#e}blob(){return this.#t}executable(){return this.#r}async references(){return await Promise.all(this.#s.map(m.get))}async bytes(){return await this.blob().bytes()}async text(){return await this.blob().text()}};var W=r=>b.new(r),b=class{#e;static new(e){return new b(e)}constructor(e){this.#e=e}static is(e){return e instanceof b}toSyscall(){return{name:this.#e}}static fromSyscall(e){let t=e.name;return new b(t)}name(){return this.#e}};var le=async r=>await w.new(r),ie=async r=>await(await w.new(r)).download(),w=class{#e;#t;#r;#s;#a;static async new(e){return w.fromSyscall(await ae.new({url:e.url,unpack:e.unpack??!1,checksum:e.checksum??void 0,unsafe:e.unsafe??!1}))}constructor(e){this.#e=e.hash,this.#t=e.url,this.#r=e.unpack??!1,this.#s=e.checksum??void 0,this.#a=e.unsafe??!1}static is(e){return e instanceof w}static expect(e){return i(w.is(e)),e}static assert(e){i(w.is(e))}hash(){return this.#e}toSyscall(){return{hash:this.#e,url:this.#t,unpack:this.#r,checksum:this.#s,unsafe:this.#a}}static fromSyscall(e){return new w({hash:e.hash,url:e.url,unpack:e.unpack,checksum:e.checksum,unsafe:e.unsafe})}async download(){let e=await H.run(C.toSyscall(this));return x.fromSyscall(e)}};var E=async(r,...e)=>{let t=[];for(let a=0;a<r.length-1;a++){let n=r[a];t.push(n);let o=e[a];t.push(o)}return t.push(r[r.length-1]),await j(...t)},j=(...r)=>u.new(...r),u=class{#e;static async new(...e){let t=[],a=o=>{if(u.Component.is(o))t.push(o);else if(o instanceof p||o instanceof g)t.push(o.toString());else if(o instanceof u)t.push(...o.components());else if(o instanceof Array)for(let s of o)a(s)};for(let o of await Promise.all(e.map(A)))a(o);let n=[];for(let o of t){let s=n.at(-1);o!==""&&(typeof s=="string"&&typeof o=="string"?n.splice(-1,1,s+o):n.push(o))}return t=n,t=Te(t),new u(t)}constructor(e){this.#e=e}static is(e){return e instanceof u}static expect(e){return i(u.is(e)),e}static assert(e){i(u.is(e))}static async join(e,...t){let a=await j(e),n=await Promise.all(t.map(s=>j(s)));n=n.filter(s=>s.components().length>0);let o=[];for(let s=0;s<n.length;s++){s>0&&o.push(a);let l=n[s];i(l),o.push(l)}return j(...o)}toSyscall(){return{components:this.#e.map(t=>u.Component.toSyscall(t))}}static fromSyscall(e){let t=e.components.map(a=>u.Component.fromSyscall(a));return new u(t)}components(){return[...this.#e]}};(e=>{let r;(o=>(o.is=s=>typeof s=="string"||m.is(s)||s instanceof b,o.toSyscall=s=>typeof s=="string"?{kind:"string",value:s}:m.is(s)?{kind:"artifact",value:m.toSyscall(s)}:s instanceof b?{kind:"placeholder",value:s.toSyscall()}:v(),o.fromSyscall=s=>{switch(s.kind){case"string":return s.value;case"artifact":return m.fromSyscall(s.value);case"placeholder":return b.fromSyscall(s.value);default:return v()}}))(r=e.Component||={})})(u||={});(e=>{let r;(a=>a.is=n=>e.Component.is(n)||n instanceof p||n instanceof g||n instanceof e||n instanceof Array&&n.every(e.Arg.is))(r=e.Arg||={})})(u||={});var Pe=r=>{let e=r.split(`
`);if(e.length!=1&&(e=e.filter(t=>!/^\s*$/.exec(t)),e=e.map(t=>/^\s*/.exec(t)?.map(n=>n)??[]).flat(),e.length!=0))return e.reduce((t,a)=>{let n=t?.length??0,o=a?.length??0;return n<o?t:a})},Te=r=>{let e;for(let t of r)if(typeof t=="string"){let a=Pe(t);(a&&!e||a&&e&&a.length<e.length)&&(e=a)}if(e){let t=e;r=r.map(a=>typeof a=="string"?a.split(`
`).map(n=>(n.startsWith(t)&&(n=n.replace(t,"")),n)).join(`
`):a)}return r};var ce=async r=>await f.new(r),f=class{#e;#t;static async new(e){let t=await A(e),a,n;if(typeof t=="string")n=t;else if(p.is(t)||g.is(t))n=t.toString();else if(m.is(t))a=t;else if(t instanceof u){i(t.components().length<=2);let[s,l]=t.components();if(typeof s=="string"&&l===void 0)n=s;else if(m.is(s)&&l===void 0)a=s;else if(m.is(s)&&typeof l=="string")a=s,i(l.startsWith("/")),n=l.slice(1);else throw new Error("Invalid template.")}else{if(t instanceof f)return t;if(typeof t=="object"){a=t.artifact;let s=t.path;typeof s=="string"?n=s:g.is(s)&&(n=s.toString())}}let o;return a!==void 0&&n!==void 0?o=await E`${a}/${n}`:a!==void 0&&n===void 0?o=await E`${a}`:a===void 0&&n!==void 0?o=await E`${n}`:o=await E``,f.fromSyscall(await ne.new({target:o.toSyscall()}))}constructor(e){this.#e=e.hash,this.#t=e.target}static is(e){return e instanceof f}static expect(e){return i(f.is(e)),e}static assert(e){i(f.is(e))}toSyscall(){let e=this.#e,t=this.#t.toSyscall();return{hash:e,target:t}}static fromSyscall(e){let t=e.hash,a=u.fromSyscall(e.target);return new f({hash:t,target:a})}hash(){return this.#e}target(){return this.#t}artifact(){let e=this.#t.components().at(0);if(m.is(e))return e}path(){let[e,t]=this.#t.components();if(typeof e=="string"&&t===void 0)return k(e);if(m.is(e)&&t===void 0)return k();if(m.is(e)&&typeof t=="string")return k(t);throw new Error("Invalid template.")}async resolve(){let e=this;for(;f.is(e);){let t=e.artifact(),a=e.path();if(c.is(t))e=await t.get(a);else if(y.is(t))i(a.components().length===0),e=t;else if(f.is(t))i(a.components().length===0),e=t;else throw new Error("Cannot resolve a symlink without an artifact in its target.")}return e}};var x;(o=>(o.is=s=>s===void 0||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Uint8Array||s instanceof p||s instanceof g||s instanceof d||s instanceof c||s instanceof y||s instanceof f||s instanceof b||s instanceof u||s instanceof P||s instanceof Function||s instanceof w||s instanceof Array||typeof s=="object",o.expect=s=>(i((0,o.is)(s)),s),o.assert=s=>{i((0,o.is)(s))},o.toSyscall=s=>s===void 0?{kind:"null",value:null}:typeof s=="boolean"?{kind:"bool",value:s}:typeof s=="number"?{kind:"number",value:s}:typeof s=="string"?{kind:"string",value:s}:s instanceof Uint8Array?{kind:"bytes",value:s}:s instanceof p?{kind:"relpath",value:s.toSyscall()}:s instanceof g?{kind:"subpath",value:s.toSyscall()}:s instanceof d?{kind:"blob",value:s.toSyscall()}:m.is(s)?{kind:"artifact",value:m.toSyscall(s)}:s instanceof b?{kind:"placeholder",value:s.toSyscall()}:s instanceof u?{kind:"template",value:s.toSyscall()}:C.is(s)?{kind:"operation",value:C.toSyscall(s)}:s instanceof Array?{kind:"array",value:s.map(h=>o.toSyscall(h))}:typeof s=="object"?{kind:"object",value:Object.fromEntries(Object.entries(s).map(([h,T])=>[h,o.toSyscall(T)]))}:v(),o.fromSyscall=s=>{switch(s.kind){case"null":return;case"bool":return s.value;case"number":return s.value;case"string":return s.value;case"bytes":return s.value;case"relpath":return p.fromSyscall(s.value);case"subpath":return g.fromSyscall(s.value);case"blob":return d.fromSyscall(s.value);case"artifact":return m.fromSyscall(s.value);case"placeholder":return b.fromSyscall(s.value);case"template":return u.fromSyscall(s.value);case"operation":return C.fromSyscall(s.value);case"array":return s.value.map(l=>o.fromSyscall(l));case"object":return Object.fromEntries(Object.entries(s.value).map(([l,h])=>[l,o.fromSyscall(h)]));default:return v()}}))(x||={});var G={},ue=async r=>{i(r.module.kind==="normal");let e=S.fromSyscall(await Q.new({packageHash:r.module.value.packageHash,modulePath:r.module.value.modulePath,name:r.name,env:{},args:[]}));e.f=r.f;let t=X.encode({module:r.module,name:r.name});return i(G[t]===void 0),G[t]=e,e},me=async(r,e,t)=>{K.value=Object.fromEntries(Object.entries(e).map(([s,l])=>[s,x.fromSyscall(l)]));let a=t.map(s=>x.fromSyscall(s)),n=await r(...a);return x.toSyscall(n)},S=class extends globalThis.Function{f;hash;packageHash;modulePath;name;env;args;static async new(e){let t=Object.fromEntries(Object.entries(e.env??{}).map(([o,s])=>[o,x.toSyscall(s)])),a=(e.args??[]).map(o=>x.toSyscall(o)),n=S.fromSyscall(await Q.new({packageHash:e.function.packageHash,modulePath:e.function.modulePath.toSyscall(),name:e.function.name,env:t,args:a}));return n.f=e.function.f,n}constructor(e){return super(),this.f=e.f,this.hash=e.hash,this.packageHash=e.packageHash,this.modulePath=k(e.modulePath),this.name=e.name,this.env=e.env,this.args=e.args,new Proxy(this,{apply:async(t,a,n)=>{let o=await S.new({function:t,args:await Promise.all(n.map(A))}),s=await H.run(C.toSyscall(o));return x.fromSyscall(s)}})}static is(e){return e instanceof S}static expect(e){return i(S.is(e)),e}static assert(e){i(S.is(e))}toSyscall(){let e=this.hash,t=this.packageHash,a=this.modulePath.toString(),n=this.name,o=this.env?Object.fromEntries(Object.entries(this.env).map(([l,h])=>[l,x.toSyscall(h)])):void 0,s=this.args?this.args.map(l=>x.toSyscall(l)):void 0;return{hash:e,packageHash:t,modulePath:a,name:n,env:o,args:s}}static fromSyscall(e){let t=e.hash,a=e.packageHash,n=e.modulePath,o=e.name,s=e.env!==void 0?Object.fromEntries(Object.entries(e.env).map(([h,T])=>[h,x.fromSyscall(T)])):void 0,l=e.args!==void 0?e.args.map(h=>x.fromSyscall(h)):void 0;return new S({hash:t,packageHash:a,modulePath:n,name:o,env:s,args:l})}};var C;(a=>(a.is=n=>n instanceof P||n instanceof S||n instanceof w,a.toSyscall=n=>n instanceof P?{kind:"command",value:n.toSyscall()}:n instanceof S?{kind:"function",value:n.toSyscall()}:n instanceof w?{kind:"resource",value:n.toSyscall()}:v(),a.fromSyscall=n=>{switch(n.kind){case"command":return P.fromSyscall(n.value);case"function":return S.fromSyscall(n.value);case"resource":return w.fromSyscall(n.value);default:return v()}}))(C||={});var pe=async r=>await P.new(r),ye=async r=>await(await P.new(r)).run(),fe=W("output"),P=class{#e;#t;#r;#s;#a;#n;#o;#l;#i;static async new(e){let t=await A(e),a=t.system,n=await j(t.executable),o=Object.fromEntries(await Promise.all(Object.entries(t.env??{}).map(async([V,J])=>[V,await j(J)]))),s=Object.fromEntries(Object.entries(o).map(([V,J])=>[V,J.toSyscall()])),l=await Promise.all((t.args??[]).map(async V=>(await j(V)).toSyscall())),h=t.checksum??void 0,T=t.unsafe??!1,R=t.network??!1,U=t.hostPaths??[];return P.fromSyscall(await ee.new({system:a,executable:n.toSyscall(),env:s,args:l,checksum:h,unsafe:T,network:R,hostPaths:U}))}constructor(e){this.#e=e.hash,this.#t=e.system,this.#r=e.executable,this.#s=e.env,this.#a=e.args,this.#n=e.checksum,this.#o=e.unsafe,this.#l=e.network,this.#i=e.hostPaths}toSyscall(){let e=this.#e,t=this.#t,a=this.#r.toSyscall(),n=Object.fromEntries(Object.entries(this.#s).map(([R,U])=>[R,U.toSyscall()])),o=this.#a.map(R=>R.toSyscall()),s=this.#n,l=this.#o,h=this.#l,T=this.#i;return{hash:e,system:t,executable:a,env:n,args:o,checksum:s,unsafe:l,network:h,hostPaths:T}}static fromSyscall(e){let t=e.hash,a=e.system,n=u.fromSyscall(e.executable),o=Object.fromEntries(Object.entries(e.env).map(([U,V])=>[U,u.fromSyscall(V)])),s=e.args.map(U=>u.fromSyscall(U)),l=e.checksum,h=e.unsafe,T=e.network,R=e.hostPaths;return new P({hash:t,system:a,executable:n,env:o,args:s,checksum:l,unsafe:h,network:T,hostPaths:R})}hash(){return this.#e}async run(){let e=await H.run(C.toSyscall(this));return x.fromSyscall(e)}};var A=async r=>{if(r=await r,r===void 0||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Uint8Array||r instanceof p||r instanceof g||r instanceof d||r instanceof c||r instanceof y||r instanceof f||r instanceof b||r instanceof u||r instanceof P||r instanceof Function||r instanceof w)return r;if(r instanceof Array)return await Promise.all(r.map(e=>A(e)));if(typeof r=="object")return Object.fromEntries(await Promise.all(Object.entries(r).map(async([e,t])=>[e,await A(t)])));throw new Error("Invalid value to resolve.")};var I=async r=>await d.new(r),d=class{#e;static async new(e){let t=await A(e),a;if(t instanceof Uint8Array||typeof t=="string")a=t;else return t;return d.fromSyscall(await z.new(a))}constructor(e){this.#e=e.hash}static is(e){return e instanceof d}static expect(e){return i(d.is(e)),e}static assert(e){i(d.is(e))}toSyscall(){return{hash:this.#e}}static fromSyscall(e){let t=e.hash;return new d({hash:t})}hash(){return this.#e}async bytes(){return await z.bytes(this.toSyscall())}async text(){return await z.text(this.toSyscall())}};(e=>{let r;(o=>(o.is=s=>s instanceof Uint8Array||typeof s=="string"||s instanceof e,o.expect=s=>(i((0,o.is)(s)),s),o.assert=s=>{i((0,o.is)(s))}))(r=e.Arg||={})})(d||={});var he=async(...r)=>await c.new(...r),c=class{#e;#t;static async new(...e){let t={};for(let a of await Promise.all(e.map(A)))if(a!==void 0){if(a instanceof c)for(let[n,o]of Object.entries(await a.entries())){let s=t[n];s instanceof c&&o instanceof c&&(o=await c.new(s,o)),t[n]=o}else if(typeof a=="object")for(let[n,o]of Object.entries(a)){let[s,...l]=k(n).components();if(s===void 0)throw new Error("The path must have at least one component.");let h=s,T=t[h];if(T instanceof c||(T=void 0),l.length>0){let R=k(l).toString(),U=await c.new(T,{[R]:o});t[h]=U}else if(o===void 0)delete t[h];else if(d.Arg.is(o)){let R=await L(o);t[h]=R}else if(y.is(o)||f.is(o))t[h]=o;else{let R=await c.new(T,o);t[h]=R}}}return c.fromSyscall(await te.new({entries:Object.fromEntries(Object.entries(t).map(([a,n])=>[a,m.toSyscall(n)]))}))}constructor(e){this.#e=e.hash,this.#t=e.entries}static is(e){return e instanceof c}static expect(e){return i(c.is(e)),e}static assert(e){i(c.is(e))}toSyscall(){return{hash:this.#e,entries:this.#t}}static fromSyscall(e){let t=e.hash,a=e.entries;return new c({hash:t,entries:a})}hash(){return this.#e}async get(e){let t=await this.tryGet(e);return i(t,`Failed to get the directory entry "${e}".`),t}async tryGet(e){let t=this;for(let a of k(e).components()){if(!(t instanceof c))return;let n=t.#t[a];if(!n)return;t=await m.get(n)}return t}async entries(){let e={};for await(let[t,a]of this)e[t]=a;return e}async bundle(){let e=m.fromSyscall(await D.bundle(m.toSyscall(this)));return i(c.is(e)),e}async*walk(){for await(let[e,t]of this)if(yield[k(e),t],c.is(t))for await(let[a,n]of t.walk())yield[k(e).join(a),n]}*[Symbol.iterator](){for(let[e,t]of Object.entries(this.#t))yield[e,t]}async*[Symbol.asyncIterator](){for(let e of Object.keys(this.#t))yield[e,await this.get(e)]}};var m;(s=>(s.is=l=>l instanceof c||l instanceof y||l instanceof f,s.expect=l=>(i((0,s.is)(l)),l),s.assert=l=>{i((0,s.is)(l))},s.get=async l=>s.fromSyscall(await D.get(l)),s.toSyscall=l=>l instanceof c?{kind:"directory",value:l.toSyscall()}:l instanceof y?{kind:"file",value:l.toSyscall()}:l instanceof f?{kind:"symlink",value:l.toSyscall()}:v(),s.fromSyscall=l=>{switch(l.kind){case"directory":return c.fromSyscall(l.value);case"file":return y.fromSyscall(l.value);case"symlink":return f.fromSyscall(l.value);default:return v()}}))(m||={});var de=(r,e)=>({callSites:e.map(a=>({typeName:a.getTypeName(),functionName:a.getFunctionName(),methodName:a.getMethodName(),fileName:a.getFileName(),lineNumber:a.getLineNumber(),columnNumber:a.getColumnNumber(),isEval:a.isEval(),isNative:a.isNative(),isConstructor:a.isConstructor(),isAsync:a.isAsync(),isPromiseAll:a.isPromiseAll(),promiseIndex:a.getPromiseIndex()}))});var ge=async r=>{i(r.module.kind==="normal");let e=m.get(r.module.value.packageHash);c.assert(e);let t=k(r.module.value.modulePath).toRelpath().join(r.path).toSubpath();return e.get(t)};var Y=(...r)=>{let e=r.map(t=>Re(t)).join(" ");se(e)},Re=r=>q(r,new WeakSet),q=(r,e)=>{switch(typeof r){case"string":return`"${r}"`;case"number":return r.toString();case"boolean":return r?"true":"false";case"undefined":return"undefined";case"object":return r===null?"null":ve(r,e);case"function":return`(function "${r.name??"(anonymous)"}")`;case"symbol":return"(symbol)";case"bigint":return r.toString()}},ve=(r,e)=>{if(e.has(r))return"(circular)";if(e.add(r),r instanceof Array)return`[${r.map(t=>q(t,e)).join(", ")}]`;if(r instanceof Error)return r.stack??"";if(r instanceof Promise)return"(promise)";if(r instanceof c)return`(tg.directory ${r.hash()})`;if(r instanceof y)return`(tg.file ${r.hash()})`;if(r instanceof f)return`(tg.symlink ${r.hash()})`;if(r instanceof b)return`(tg.placeholder "${r.name()}")`;if(r instanceof u)return`(tg.template "${r.components().map(a=>typeof a=="string"?a:`\${${q(a,e)}}`).join("")}")`;{let t="";r.constructor!==void 0&&r.constructor.name!=="Object"&&(t=`${r.constructor.name} `);let a=Object.entries(r).map(([n,o])=>`${n}: ${q(o,e)}`);return`${t}{ ${a.join(", ")} }`}};var be=r=>{if(typeof r=="string")return r;{let{arch:e,os:t}=r;return`${e}_${t}`}},Z;(a=>(a.is=n=>n==="amd64_linux"||n==="arm64_linux"||n==="amd64_macos"||n==="arm64_macos",a.arch=n=>{switch(n){case"amd64_linux":case"amd64_macos":return"amd64";case"arm64_linux":case"arm64_macos":return"arm64";default:throw new Error("Invalid system.")}},a.os=n=>{switch(n){case"amd64_linux":case"arm64_linux":return"linux";case"amd64_macos":case"arm64_macos":return"macos";default:throw new Error("Invalid system.")}}))(Z||={});Object.defineProperties(Error,{prepareStackTrace:{value:de}});var Ce={log:Y};Object.defineProperties(globalThis,{console:{value:Ce}});var Oe={Artifact:m,Blob:d,Directory:c,File:y,Function:S,Placeholder:b,Relpath:p,Subpath:g,Symlink:f,System:Z,Template:u,Value:x,base64:F,blob:I,command:pe,directory:he,download:ie,entrypoint:me,env:K,file:L,function:ue,hex:B,include:ge,json:N,log:Y,output:fe,placeholder:W,registry:G,relpath:oe,resolve:A,resource:le,run:ye,subpath:k,symlink:ce,system:be,template:j,toml:_,utf8:$,yaml:M};Object.defineProperties(globalThis,{tg:{value:Oe},t:{value:E}});})();
//# sourceMappingURL=global.js.map
