"use strict";(()=>{var i=(r,e)=>{if(!r)throw new Error(e??"Failed assertion.")};var O=r=>{throw new Error(r??"Reached unreachable code.")};var B={get(){return i(this.value),this.value}};var G=(...r)=>f.new(...r),S=(...r)=>g.new(...r),f=class{#e;#t;static new(...e){let t=new f,a=n=>{if(typeof n=="string")for(let o of n.split("/"))o===""||o==="."||(o===".."?t=t.parent():t.#t.push(o));else if(n instanceof f){for(let o=0;o<n.#e;o++)t.parent();t.#t.join(n.#t)}else if(n instanceof g)t.#t.join(n);else if(n instanceof Array)for(let o of n)a(o)};for(let n of e)a(n);return t}constructor(e){this.#e=e?.parents??0,this.#t=e?.subpath??new g}static is(e){return e instanceof f}toSyscall(){return this.toString()}static fromSyscall(e){return f.new(e)}isEmpty(){return this.#e==0&&this.#t.isEmpty()}parents(){return this.#e}subpath(){return this.#t}parent(){return this.#t.isEmpty()?this.#e+=1:this.#t.pop(),this}join(e){e=f.new(e);for(let t=0;t<e.#e;t++)this.parent();return this.#t.join(e.#t),this}extension(){return this.#t.extension()}toSubpath(){if(this.#e>0)throw new Error("Cannot convert to subpath.");return this.#t}toString(){let e="";for(let t=0;t<this.#e;t++)e+="../";return e+=this.#t.toString(),e}};(e=>{let r;(o=>(o.is=s=>s===void 0||typeof s=="string"||s instanceof g||s instanceof e||s instanceof Array&&s.every(e.Arg.is),o.expect=s=>(i((0,o.is)(s)),s),o.assert=s=>{i((0,o.is)(s))}))(r=e.Arg||={})})(f||={});var g=class{#e;static new(...e){return f.new(...e).toSubpath()}constructor(e){this.#e=e??[]}static is(e){return e instanceof g}toSyscall(){return this.toString()}static fromSyscall(e){return S(e)}components(){return[...this.#e]}isEmpty(){return this.#e.length==0}join(e){return this.#e.push(...e.#e),this}push(e){this.#e.push(e)}pop(){this.#e.pop()}extension(){return this.#e.at(-1)?.split(".").at(-1)}toRelpath(){return f.new(this)}toString(){return this.#e.join("/")}};var M={bundle:async r=>{try{return await syscall("artifact_bundle",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},get:async r=>{try{return await syscall("artifact_get",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},Z={decode:r=>{try{return syscall("base64_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("base64_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},N={bytes:async r=>{try{return await syscall("blob_bytes",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},new:async r=>{try{return await syscall("blob_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},text:async r=>{try{return await syscall("blob_text",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},q={new:async r=>{try{return await syscall("function_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var J={new:async r=>{try{return await syscall("resource_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},Q={new:async r=>{try{return await syscall("directory_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},X={new:async r=>{try{return await syscall("file_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},Y={decode:r=>{try{return syscall("hex_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("hex_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},ee=async(r,e)=>{try{return await syscall("include",r,e)}catch(t){throw new Error("The syscall failed.",{cause:t})}},te={decode:r=>{try{return syscall("json_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("json_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},re=r=>{try{return syscall("log",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},F={get:async r=>{try{return await syscall("operation_get",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},run:async r=>{try{return await syscall("operation_run",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},se={new:async r=>{try{return await syscall("command_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},_=r=>{try{return syscall("stack_frame",r+1)}catch(e){throw new Error("The syscall failed.",{cause:e})}},ae={new:async r=>{try{return await syscall("symlink_new",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},ne={decode:r=>{try{return syscall("toml_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("toml_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},oe={decode:r=>{try{return syscall("utf8_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("utf8_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},le={decode:r=>{try{return syscall("yaml_decode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:r=>{try{return syscall("yaml_encode",r)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var $=async r=>await y.new(r),y=class{#e;#t;#r;#s;static async new(e){let t=await A(e),a,n,o;if(d.Arg.is(t))a=await I(t),n=!1,o=[];else{if(y.is(t))return t;a=await I(t.blob),n=t.executable??!1,o=t.references??[]}return y.fromSyscall(await X.new({blob:a.toSyscall(),executable:n,references:o.map(s=>m.toSyscall(s))}))}constructor(e){this.#e=e.hash,this.#t=e.blob,this.#r=e.executable,this.#s=e.references}static is(e){return e instanceof y}static expect(e){return i(y.is(e)),e}static assert(e){i(y.is(e))}toSyscall(){return{hash:this.#e,blob:this.#t.toSyscall(),executable:this.#r,references:this.#s}}static fromSyscall(e){return new y({hash:e.hash,blob:d.fromSyscall(e.blob),executable:e.executable,references:e.references})}hash(){return this.#e}blob(){return this.#t}executable(){return this.#r}async references(){return await Promise.all(this.#s.map(m.get))}async bytes(){return await this.blob().bytes()}async text(){return await this.blob().text()}};var z=r=>b.new(r),b=class{#e;static new(e){return new b(e)}constructor(e){this.#e=e}static is(e){return e instanceof b}toSyscall(){return{name:this.#e}}static fromSyscall(e){let t=e.name;return new b(t)}name(){return this.#e}};var ie=async r=>await w.new(r),ce=async r=>await(await w.new(r)).download(),w=class{#e;#t;#r;#s;#a;static async new(e){return w.fromSyscall(await J.new({url:e.url,unpack:e.unpack??!1,checksum:e.checksum??void 0,unsafe:e.unsafe??!1}))}constructor(e){this.#e=e.hash,this.#t=e.url,this.#r=e.unpack??!1,this.#s=e.checksum??void 0,this.#a=e.unsafe??!1}static is(e){return e instanceof w}static expect(e){return i(w.is(e)),e}static assert(e){i(w.is(e))}hash(){return this.#e}toSyscall(){return{hash:this.#e,url:this.#t,unpack:this.#r,checksum:this.#s,unsafe:this.#a}}static fromSyscall(e){return new w({hash:e.hash,url:e.url,unpack:e.unpack,checksum:e.checksum,unsafe:e.unsafe})}async download(){let e=await F.run(j.toSyscall(this));return x.fromSyscall(e)}};var H=async(r,...e)=>{let t=[];for(let a=0;a<r.length-1;a++){let n=r[a];t.push(n);let o=e[a];t.push(o)}return t.push(r[r.length-1]),await E(...t)},c=class{#e;static async new(...e){let t=[],a=o=>{if(c.Component.is(o))t.push(o);else if(o instanceof f||o instanceof g)t.push(o.toString());else if(o instanceof c)t.push(...o.components());else if(o instanceof Array)for(let s of o)a(s)};for(let o of await Promise.all(e.map(A)))a(o);let n=[];for(let o of t){let s=n.at(-1);o!==""&&(typeof s=="string"&&typeof o=="string"?n.splice(-1,1,s+o):n.push(o))}return t=n,t=xe(t),new c(t)}constructor(e){this.#e=e}static is(e){return e instanceof c}static expect(e){return i(c.is(e)),e}static assert(e){i(c.is(e))}static async join(e,...t){let a=await E(e),n=await Promise.all(t.map(s=>E(s)));n=n.filter(s=>s.components().length>0);let o=[];for(let s=0;s<n.length;s++){s>0&&o.push(a);let l=n[s];i(l),o.push(l)}return E(...o)}toSyscall(){return{components:this.#e.map(t=>c.Component.toSyscall(t))}}static fromSyscall(e){let t=e.components.map(a=>c.Component.fromSyscall(a));return new c(t)}components(){return[...this.#e]}};(e=>{let r;(o=>(o.is=s=>typeof s=="string"||m.is(s)||s instanceof b,o.toSyscall=s=>typeof s=="string"?{kind:"string",value:s}:m.is(s)?{kind:"artifact",value:m.toSyscall(s)}:s instanceof b?{kind:"placeholder",value:s.toSyscall()}:O(),o.fromSyscall=s=>{switch(s.kind){case"string":return s.value;case"artifact":return m.fromSyscall(s.value);case"placeholder":return b.fromSyscall(s.value);default:return O()}}))(r=e.Component||={})})(c||={});(e=>{let r;(a=>a.is=n=>e.Component.is(n)||n instanceof f||n instanceof g||n instanceof e||n instanceof Array&&n.every(e.Arg.is))(r=e.Arg||={})})(c||={});var E=c.new,we=r=>{let e=r.split(`
`);if(e.length!=1&&(e=e.filter(t=>!/^\s*$/.exec(t)),e=e.map(t=>/^\s*/.exec(t)?.map(n=>n)??[]).flat(),e.length!=0))return e.reduce((t,a)=>{let n=t?.length??0,o=a?.length??0;return n<o?t:a})},xe=r=>{let e;for(let t of r)if(typeof t=="string"){let a=we(t);(a&&!e||a&&e&&a.length<e.length)&&(e=a)}if(e){let t=e;r=r.map(a=>typeof a=="string"?a.split(`
`).map(n=>(n.startsWith(t)&&(n=n.replace(t,"")),n)).join(`
`):a)}return r};var ue=async r=>await h.new(r),h=class{#e;#t;static async new(e){let t=await A(e),a,n;if(typeof t=="string")n=t;else if(f.is(t)||g.is(t))n=t.toString();else if(m.is(t))a=t;else if(t instanceof c){i(t.components().length<=2);let[s,l]=t.components();if(typeof s=="string"&&l===void 0)n=s;else if(m.is(s)&&l===void 0)a=s;else if(m.is(s)&&typeof l=="string")a=s,i(l.startsWith("/")),n=l.slice(1);else throw new Error("Invalid template.")}else{if(t instanceof h)return t;if(typeof t=="object"){a=t.artifact;let s=t.path;typeof s=="string"?n=s:g.is(s)&&(n=s.toString())}}let o;return a!==void 0&&n!==void 0?o=await H`${a}/${n}`:a!==void 0&&n===void 0?o=await H`${a}`:a===void 0&&n!==void 0?o=await H`${n}`:o=await H``,h.fromSyscall(await ae.new({target:o.toSyscall()}))}constructor(e){this.#e=e.hash,this.#t=e.target}static is(e){return e instanceof h}static expect(e){return i(h.is(e)),e}static assert(e){i(h.is(e))}toSyscall(){let e=this.#e,t=this.#t.toSyscall();return{hash:e,target:t}}static fromSyscall(e){let t=e.hash,a=c.fromSyscall(e.target);return new h({hash:t,target:a})}hash(){return this.#e}target(){return this.#t}artifact(){let e=this.#t.components().at(0);if(m.is(e))return e}path(){let[e,t]=this.#t.components();if(typeof e=="string"&&t===void 0)return S(e);if(m.is(e)&&t===void 0)return S();if(m.is(e)&&typeof t=="string")return S(t);throw new Error("Invalid template.")}async resolve(){let e=this;for(;h.is(e);){let t=e.artifact(),a=e.path();if(u.is(t))e=await t.get(a);else if(y.is(t))i(a.components().length===0),e=t;else if(h.is(t))i(a.components().length===0),e=t;else throw new Error("Cannot resolve a symlink without an artifact in its target.")}return e}};var x;(o=>(o.is=s=>s===void 0||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Uint8Array||s instanceof f||s instanceof g||s instanceof d||s instanceof u||s instanceof y||s instanceof h||s instanceof b||s instanceof c||s instanceof v||s instanceof Function||s instanceof w||s instanceof Array||typeof s=="object",o.expect=s=>(i((0,o.is)(s)),s),o.assert=s=>{i((0,o.is)(s))},o.toSyscall=s=>s===void 0?{kind:"null",value:null}:typeof s=="boolean"?{kind:"bool",value:s}:typeof s=="number"?{kind:"number",value:s}:typeof s=="string"?{kind:"string",value:s}:s instanceof Uint8Array?{kind:"bytes",value:s}:s instanceof f?{kind:"relpath",value:s.toSyscall()}:s instanceof g?{kind:"subpath",value:s.toSyscall()}:s instanceof d?{kind:"blob",value:s.toSyscall()}:m.is(s)?{kind:"artifact",value:m.toSyscall(s)}:s instanceof b?{kind:"placeholder",value:s.toSyscall()}:s instanceof c?{kind:"template",value:s.toSyscall()}:j.is(s)?{kind:"operation",value:j.toSyscall(s)}:s instanceof Array?{kind:"array",value:s.map(p=>o.toSyscall(p))}:typeof s=="object"?{kind:"object",value:Object.fromEntries(Object.entries(s).map(([p,P])=>[p,o.toSyscall(P)]))}:O(),o.fromSyscall=s=>{switch(s.kind){case"null":return;case"bool":return s.value;case"number":return s.value;case"string":return s.value;case"bytes":return s.value;case"relpath":return f.fromSyscall(s.value);case"subpath":return g.fromSyscall(s.value);case"blob":return d.fromSyscall(s.value);case"artifact":return m.fromSyscall(s.value);case"placeholder":return b.fromSyscall(s.value);case"template":return c.fromSyscall(s.value);case"operation":return j.fromSyscall(s.value);case"array":return s.value.map(l=>o.fromSyscall(l));case"object":return Object.fromEntries(Object.entries(s.value).map(([l,p])=>[l,o.fromSyscall(p)]));default:return O()}}))(x||={});var me=async r=>await R.new(r),W=async r=>{let e=await R.new(r),t=await F.run(j.toSyscall(e));return x.fromSyscall(t)},pe=async(r,e,t)=>{B.value=Object.fromEntries(Object.entries(e).map(([s,l])=>[s,x.fromSyscall(l)]));let a=t.map(s=>x.fromSyscall(s)),n=await r(...a);return x.toSyscall(n)},R=class extends globalThis.Function{f;hash;packageInstanceHash;modulePath;name;env;args;static async new(e){let t,a,n,o,s,l;if(e instanceof globalThis.Function){t=e;let{module:k,line:C}=_(2);if(i(k.kind==="normal"),a=k.value.packageInstanceHash,n=S(k.value.modulePath),C.startsWith("export default "))o="default";else if(C.startsWith("export let ")){let U=C.match(/^export let ([a-zA-Z0-9]+)\b/)?.at(1);if(!U)throw new Error("Invalid use of tg.function.");o=U}else throw new Error("Invalid use of tg.function.")}else t=e.function.f,a=e.function.packageInstanceHash,n=S(e.function.modulePath),o=e.function.name,s=e.env??{},l=e.args??[];let p=s!==void 0?Object.fromEntries(Object.entries(s).map(([k,C])=>[k,x.toSyscall(C)])):void 0,P=l!==void 0?l.map(k=>x.toSyscall(k)):void 0,T=R.fromSyscall(await q.new({packageInstanceHash:a,modulePath:n.toSyscall(),name:o,env:p,args:P}));return T.f=t,T}constructor(e){return super(),this.f=e.f,this.hash=e.hash,this.packageInstanceHash=e.packageInstanceHash,this.modulePath=S(e.modulePath),this.name=e.name,this.env=e.env,this.args=e.args,new Proxy(this,{apply:async(t,a,n)=>await W({function:t,args:await Promise.all(n.map(A))})})}static is(e){return e instanceof R}static expect(e){return i(R.is(e)),e}static assert(e){i(R.is(e))}toSyscall(){let e=this.hash,t=this.packageInstanceHash,a=this.modulePath.toString(),n=this.name,o=this.env?Object.fromEntries(Object.entries(this.env).map(([l,p])=>[l,x.toSyscall(p)])):void 0,s=this.args?this.args.map(l=>x.toSyscall(l)):void 0;return{hash:e,packageInstanceHash:t,modulePath:a,name:n,env:o,args:s}}static fromSyscall(e){let t=e.hash,a=e.packageInstanceHash,n=e.modulePath,o=e.name,s=e.env!==void 0?Object.fromEntries(Object.entries(e.env).map(([p,P])=>[p,x.fromSyscall(P)])):void 0,l=e.args!==void 0?e.args.map(p=>x.fromSyscall(p)):void 0;return new R({hash:t,packageInstanceHash:a,modulePath:n,name:o,env:s,args:l})}};var j;(a=>(a.is=n=>n instanceof v||n instanceof R||n instanceof w,a.toSyscall=n=>n instanceof v?{kind:"command",value:n.toSyscall()}:n instanceof R?{kind:"function",value:n.toSyscall()}:n instanceof w?{kind:"resource",value:n.toSyscall()}:O(),a.fromSyscall=n=>{switch(n.kind){case"command":return v.fromSyscall(n.value);case"function":return R.fromSyscall(n.value);case"resource":return w.fromSyscall(n.value);default:return O()}}))(j||={});var fe=async r=>await v.new(r),ye=async r=>await(await v.new(r)).run(),he=z("output"),v=class{#e;#t;#r;#s;#a;#n;#o;#l;#i;static async new(e){let t=await A(e),a=t.system,n=await E(t.executable),o=Object.fromEntries(await Promise.all(Object.entries(t.env??{}).map(async([C,U])=>[C,await E(U)]))),s=Object.fromEntries(Object.entries(o).map(([C,U])=>[C,U.toSyscall()])),l=await Promise.all((t.args??[]).map(async C=>(await E(C)).toSyscall())),p=t.checksum??void 0,P=t.unsafe??!1,T=t.network??!1,k=t.hostPaths??[];return v.fromSyscall(await se.new({system:a,executable:n.toSyscall(),env:s,args:l,checksum:p,unsafe:P,network:T,hostPaths:k}))}constructor(e){this.#e=e.hash,this.#t=e.system,this.#r=e.executable,this.#s=e.env,this.#a=e.args,this.#n=e.checksum,this.#o=e.unsafe,this.#l=e.network,this.#i=e.hostPaths}toSyscall(){let e=this.#e,t=this.#t,a=this.#r.toSyscall(),n=Object.fromEntries(Object.entries(this.#s).map(([T,k])=>[T,k.toSyscall()])),o=this.#a.map(T=>T.toSyscall()),s=this.#n,l=this.#o,p=this.#l,P=this.#i;return{hash:e,system:t,executable:a,env:n,args:o,checksum:s,unsafe:l,network:p,hostPaths:P}}static fromSyscall(e){let t=e.hash,a=e.system,n=c.fromSyscall(e.executable),o=Object.fromEntries(Object.entries(e.env).map(([k,C])=>[k,c.fromSyscall(C)])),s=e.args.map(k=>c.fromSyscall(k)),l=e.checksum,p=e.unsafe,P=e.network,T=e.hostPaths;return new v({hash:t,system:a,executable:n,env:o,args:s,checksum:l,unsafe:p,network:P,hostPaths:T})}hash(){return this.#e}async run(){let e=await F.run(j.toSyscall(this));return x.fromSyscall(e)}};var A=async r=>{if(r=await r,r===void 0||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Uint8Array||r instanceof f||r instanceof g||r instanceof d||r instanceof u||r instanceof y||r instanceof h||r instanceof b||r instanceof c||r instanceof v||r instanceof Function||r instanceof w)return r;if(r instanceof Array)return await Promise.all(r.map(e=>A(e)));if(typeof r=="object")return Object.fromEntries(await Promise.all(Object.entries(r).map(async([e,t])=>[e,await A(t)])));throw new Error("Invalid value to resolve.")};var I=async r=>await d.new(r),d=class{#e;static async new(e){let t=await A(e),a;if(t instanceof Uint8Array||typeof t=="string")a=t;else return t;return d.fromSyscall(await N.new(a))}constructor(e){this.#e=e.hash}static is(e){return e instanceof d}static expect(e){return i(d.is(e)),e}static assert(e){i(d.is(e))}toSyscall(){return{hash:this.#e}}static fromSyscall(e){let t=e.hash;return new d({hash:t})}hash(){return this.#e}async bytes(){return await N.bytes(this.toSyscall())}async text(){return await N.text(this.toSyscall())}};(e=>{let r;(o=>(o.is=s=>s instanceof Uint8Array||typeof s=="string"||s instanceof e,o.expect=s=>(i((0,o.is)(s)),s),o.assert=s=>{i((0,o.is)(s))}))(r=e.Arg||={})})(d||={});var de=async r=>await u.new(r),u=class{#e;#t;static async new(...e){let t=new Map;for(let a of await Promise.all(e.map(A)))if(a!==void 0){if(a instanceof u)for(let[n,o]of await a.entries()){let s=t.get(n);s instanceof u&&o instanceof u&&(o=await u.new(s,o)),t.set(n,o)}else if(typeof a=="object")for(let[n,o]of Object.entries(a)){let[s,...l]=S(n).components();if(s===void 0)throw new Error("The path must have at least one component.");let p=s,P=t.get(p);if(P instanceof u||(P=void 0),l.length>0){let T=S(l).toString(),k=await u.new(P,{[T]:o});t.set(p,k)}else if(o===void 0)t.delete(p);else if(d.Arg.is(o)){let T=await $(o);t.set(p,T)}else if(y.is(o)||h.is(o))t.set(p,o);else{let T=await u.new(P,o);t.set(p,T)}}}return u.fromSyscall(await Q.new({entries:Object.fromEntries(Array.from(t,([a,n])=>[a,m.toSyscall(n)]))}))}constructor(e){this.#e=e.hash,this.#t=e.entries}static is(e){return e instanceof u}static expect(e){return i(u.is(e)),e}static assert(e){i(u.is(e))}toSyscall(){return{hash:this.#e,entries:Object.fromEntries(this.#t)}}static fromSyscall(e){let t=e.hash,a=new Map(Object.entries(e.entries));return new u({hash:t,entries:a})}hash(){return this.#e}async get(e){let t=await this.tryGet(e);return i(t,`Failed to get the directory entry "${e}".`),t}async tryGet(e){let t=this;for(let a of S(e).components()){if(!(t instanceof u))return;let n=t.#t.get(a);if(!n)return;t=await m.get(n)}return t}async entries(){let e=new Map;for await(let[t,a]of this)e.set(t,a);return e}async bundle(){let e=m.fromSyscall(await M.bundle(m.toSyscall(this)));return i(u.is(e)),e}async*walk(){for await(let[e,t]of this)if(yield[S(e),t],u.is(t))for await(let[a,n]of t.walk())yield[S(e).join(a),n]}*[Symbol.iterator](){for(let[e,t]of this.#t)yield[e,t]}async*[Symbol.asyncIterator](){for(let e of this.#t.keys())yield[e,await this.get(e)]}};var m;(s=>(s.is=l=>l instanceof u||l instanceof y||l instanceof h,s.expect=l=>(i((0,s.is)(l)),l),s.assert=l=>{i((0,s.is)(l))},s.get=async l=>s.fromSyscall(await M.get(l)),s.toSyscall=l=>l instanceof u?{kind:"directory",value:l.toSyscall()}:l instanceof y?{kind:"file",value:l.toSyscall()}:l instanceof h?{kind:"symlink",value:l.toSyscall()}:O(),s.fromSyscall=l=>{switch(l.kind){case"directory":return u.fromSyscall(l.value);case"file":return y.fromSyscall(l.value);case"symlink":return h.fromSyscall(l.value);default:return O()}}))(m||={});var ge=(r,e)=>({callSites:e.map(a=>({typeName:a.getTypeName(),functionName:a.getFunctionName(),methodName:a.getMethodName(),fileName:a.getFileName(),lineNumber:a.getLineNumber(),columnNumber:a.getColumnNumber(),isEval:a.isEval(),isNative:a.isNative(),isConstructor:a.isConstructor(),isAsync:a.isAsync(),isPromiseAll:a.isPromiseAll(),promiseIndex:a.getPromiseIndex()}))});var be=async r=>{let e=_(1);return m.fromSyscall(await ee(e,r))};var K=(...r)=>{let e=r.map(t=>ke(t)).join(" ");re(e)},ke=r=>D(r,new WeakSet),D=(r,e)=>{switch(typeof r){case"string":return`"${r}"`;case"number":return r.toString();case"boolean":return r?"true":"false";case"undefined":return"undefined";case"object":return r===null?"null":Se(r,e);case"function":return`(function "${r.name??"(anonymous)"}")`;case"symbol":return"(symbol)";case"bigint":return r.toString()}},Se=(r,e)=>{if(e.has(r))return"(circular)";if(e.add(r),r instanceof Array)return`[${r.map(t=>D(t,e)).join(", ")}]`;if(r instanceof Error)return r.stack??"";if(r instanceof Promise)return"(promise)";if(r instanceof u)return`(tg.directory ${r.hash()})`;if(r instanceof y)return`(tg.file ${r.hash()})`;if(r instanceof h)return`(tg.symlink ${r.hash()})`;if(r instanceof b)return`(tg.placeholder "${r.name()}")`;if(r instanceof c)return`(tg.template "${r.components().map(a=>typeof a=="string"?a:`\${${D(a,e)}}`).join("")}")`;{let t="";r.constructor!==void 0&&r.constructor.name!=="Object"&&(t=`${r.constructor.name} `);let a=Object.entries(r).map(([n,o])=>`${n}: ${D(o,e)}`);return`${t}{ ${a.join(", ")} }`}};var Ae=r=>{if(typeof r=="string")return r;{let{arch:e,os:t}=r;return`${e}_${t}`}},L;(a=>(a.is=n=>n==="amd64_linux"||n==="arm64_linux"||n==="amd64_macos"||n==="arm64_macos",a.arch=n=>{switch(n){case"amd64_linux":case"amd64_macos":return"amd64";case"arm64_linux":case"arm64_macos":return"arm64";default:throw new Error("Invalid system.")}},a.os=n=>{switch(n){case"amd64_linux":case"arm64_linux":return"linux";case"amd64_macos":case"arm64_macos":return"macos";default:throw new Error("Invalid system.")}}))(L||={});Object.defineProperties(Error,{prepareStackTrace:{value:ge}});var Pe={log:K};Object.defineProperties(globalThis,{console:{value:Pe}});var Te={Artifact:m,Blob:d,Directory:u,File:y,Function:R,Placeholder:b,Relpath:f,Subpath:g,Symlink:h,System:L,Template:c,Value:x,base64:Z,blob:I,call:W,command:fe,directory:de,download:ce,entrypoint:pe,env:B,file:$,function:me,hex:Y,include:be,json:te,log:K,output:he,placeholder:z,relpath:G,resolve:A,resource:ie,run:ye,subpath:S,symlink:ue,system:Ae,template:E,toml:ne,utf8:oe,yaml:le};Object.defineProperties(globalThis,{tg:{value:Te},t:{value:H}});})();
//# sourceMappingURL=global.js.map
