"use strict";(()=>{var i=(t,e)=>{if(!t)throw new Error(e??"Failed assertion.")};var R=t=>{throw new Error(t??"Reached unreachable code.")};var z={bundle:async t=>{try{return await syscall("artifact_bundle",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},get:async t=>{try{return await syscall("artifact_get",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},H={decode:t=>{try{return syscall("base64_decode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:t=>{try{return syscall("base64_encode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},K={bytes:async t=>{try{return await syscall("blob_bytes",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},new:async t=>{try{return await syscall("blob_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},text:async t=>{try{return await syscall("blob_text",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var te={new:t=>{try{return syscall("command_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},re={new:t=>{try{return syscall("directory_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},ne={new:t=>{try{return syscall("file_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},Q={new:t=>{try{return syscall("function_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var B={decode:t=>{try{return syscall("hex_decode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:t=>{try{return syscall("hex_encode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},D={decode:t=>{try{return syscall("json_decode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:t=>{try{return syscall("json_encode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},se=t=>{try{return syscall("log",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},F={get:async t=>{try{return await syscall("operation_get",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},run:async t=>{try{return await syscall("operation_run",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},ae={new:t=>{try{return syscall("resource_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},oe={new:t=>{try{return syscall("symlink_new",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},$={decode:t=>{try{return syscall("toml_decode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:t=>{try{return syscall("toml_encode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},N={decode:t=>{try{return syscall("utf8_decode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:t=>{try{return syscall("utf8_encode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}},_={decode:t=>{try{return syscall("yaml_decode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}},encode:t=>{try{return syscall("yaml_encode",t)}catch(e){throw new Error("The syscall failed.",{cause:e})}}};var be;(r=>(r.decode=s=>H.decode(s),r.encode=s=>H.encode(s)))(be||={});var Ae;(r=>(r.decode=s=>B.decode(s),r.encode=s=>B.encode(s)))(Ae||={});var X;(r=>(r.decode=s=>D.decode(s),r.encode=s=>D.encode(s)))(X||={});var we;(r=>(r.decode=s=>$.decode(s),r.encode=s=>$.encode(s)))(we||={});var xe;(r=>(r.decode=s=>N.decode(s),r.encode=s=>N.encode(s)))(xe||={});var ke;(r=>(r.decode=s=>_.decode(s),r.encode=s=>_.encode(s)))(ke||={});var M={get(){return i(this.value),this.value}};var E=(...t)=>p.new(...t),S=(...t)=>f.new(...t),p=class t{#e;#t;static new(...e){let r=new t,s=a=>{if(typeof a=="string")for(let o of a.split("/"))o===""||o==="."||(o===".."?r=r.parent():r.#t.push(o));else if(a instanceof t){for(let o=0;o<a.#e;o++)r.parent();r.#t.join(a.#t)}else if(a instanceof f)r.#t.join(a);else if(a instanceof Array)for(let o of a)s(o)};for(let a of e)s(a);return r}constructor(e){this.#e=e?.parents??0,this.#t=e?.subpath??new f}static is(e){return e instanceof t}toSyscall(){return this.toString()}static fromSyscall(e){return t.new(e)}isEmpty(){return this.#e==0&&this.#t.isEmpty()}parents(){return this.#e}subpath(){return this.#t}parent(){return this.#t.isEmpty()?this.#e+=1:this.#t.pop(),this}join(e){e=t.new(e);for(let r=0;r<e.#e;r++)this.parent();return this.#t.join(e.#t),this}extension(){return this.#t.extension()}toSubpath(){if(this.#e>0)throw new Error("Cannot convert to subpath.");return this.#t}toString(){let e="";for(let r=0;r<this.#e;r++)e+="../";return e+=this.#t.toString(),e}};(e=>{let t;(o=>(o.is=n=>n===void 0||typeof n=="string"||n instanceof f||n instanceof e||n instanceof Array&&n.every(e.Arg.is),o.expect=n=>(i((0,o.is)(n)),n),o.assert=n=>{i((0,o.is)(n))}))(t=e.Arg||={})})(p||={});var f=class t{#e;static new(...e){return p.new(...e).toSubpath()}constructor(e){this.#e=e??[]}static is(e){return e instanceof t}toSyscall(){return this.toString()}static fromSyscall(e){return S(e)}components(){return[...this.#e]}isEmpty(){return this.#e.length==0}join(e){return this.#e.push(...e.#e),this}push(e){this.#e.push(e)}pop(){this.#e.pop()}extension(){return this.#e.at(-1)?.split(".").at(-1)}toRelpath(){return p.new(this)}toString(){return this.#e.join("/")}};var L=async t=>await w.new(t),w=class t{#e;#t;#r;#n;static async new(e){let r=await g(e),s,a,o;if(h.Arg.is(r))s=await I(r),a=!1,o=[];else{if(t.is(r))return r;s=await I(r.blob),a=r.executable??!1,o=r.references??[]}return t.fromSyscall(ne.new({blob:s.toSyscall(),executable:a,references:o.map(n=>c.toSyscall(n))}))}constructor(e){this.#e=e.hash,this.#t=e.blob,this.#r=e.executable,this.#n=e.references}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}toSyscall(){return{hash:this.#e,blob:this.#t.toSyscall(),executable:this.#r,references:this.#n}}static fromSyscall(e){return new t({hash:e.hash,blob:h.fromSyscall(e.blob),executable:e.executable,references:e.references})}hash(){return this.#e}blob(){return this.#t}executable(){return this.#r}async references(){return await Promise.all(this.#n.map(c.get))}async bytes(){return await this.blob().bytes()}async text(){return await this.blob().text()}};var W=t=>x.new(t),x=class t{#e;static new(e){return new t(e)}constructor(e){this.#e=e}static is(e){return e instanceof t}toSyscall(){return{name:this.#e}}static fromSyscall(e){let r=e.name;return new t(r)}name(){return this.#e}};var le=async t=>await T.new(t),ie=async t=>await(await T.new(t)).download(),T=class t{#e;#t;#r;#n;#s;static async new(e){return t.fromSyscall(ae.new({url:e.url,unpack:e.unpack??void 0,checksum:e.checksum??void 0,unsafe:e.unsafe??!1}))}constructor(e){this.#e=e.hash,this.#t=e.url,this.#r=e.unpack??void 0,this.#n=e.checksum??void 0,this.#s=e.unsafe??!1}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}hash(){return this.#e}toSyscall(){return{hash:this.#e,url:this.#t,unpack:this.#r,checksum:this.#n,unsafe:this.#s}}static fromSyscall(e){return new t({hash:e.hash,url:e.url,unpack:e.unpack,checksum:e.checksum,unsafe:e.unsafe})}async download(){let e=await F.run(C.toSyscall(this));return b.fromSyscall(e)}};var V=async(t,...e)=>{let r=[];for(let s=0;s<t.length-1;s++){let a=t[s];r.push(a);let o=e[s];r.push(o)}return r.push(t[t.length-1]),await U(...r)},U=(...t)=>m.new(...t),m=class t{#e;static async new(...e){let r=[],s=o=>{if(t.Component.is(o))r.push(o);else if(o instanceof p||o instanceof f)r.push(o.toString());else if(o instanceof t)r.push(...o.components());else if(o instanceof Array)for(let n of o)s(n)};for(let o of await Promise.all(e.map(g)))s(o);let a=[];for(let o of r){let n=a.at(-1);o!==""&&(typeof n=="string"&&typeof o=="string"?a.splice(-1,1,n+o):a.push(o))}return r=a,r=Te(r),new t(r)}constructor(e){this.#e=e}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}static async join(e,...r){let s=await U(e),a=await Promise.all(r.map(n=>U(n)));a=a.filter(n=>n.components().length>0);let o=[];for(let n=0;n<a.length;n++){n>0&&o.push(s);let l=a[n];i(l),o.push(l)}return U(...o)}toSyscall(){return{components:this.#e.map(r=>t.Component.toSyscall(r))}}static fromSyscall(e){let r=e.components.map(s=>t.Component.fromSyscall(s));return new t(r)}components(){return[...this.#e]}};(e=>{let t;(o=>(o.is=n=>typeof n=="string"||c.is(n)||n instanceof x,o.toSyscall=n=>typeof n=="string"?{kind:"string",value:n}:c.is(n)?{kind:"artifact",value:c.toSyscall(n)}:n instanceof x?{kind:"placeholder",value:n.toSyscall()}:R(),o.fromSyscall=n=>{switch(n.kind){case"string":return n.value;case"artifact":return c.fromSyscall(n.value);case"placeholder":return x.fromSyscall(n.value);default:return R()}}))(t=e.Component||={})})(m||={});(e=>{let t;(s=>s.is=a=>e.Component.is(a)||a instanceof p||a instanceof f||a instanceof e||a instanceof Array&&a.every(e.Arg.is))(t=e.Arg||={})})(m||={});var Se=t=>{let e=t.split(`
`);if(e.length!=1&&(e=e.filter(r=>!/^\s*$/.exec(r)),e=e.map(r=>/^\s*/.exec(r)?.map(a=>a)??[]).flat(),e.length!=0))return e.reduce((r,s)=>{let a=r?.length??0,o=s?.length??0;return a<o?r:s})},Te=t=>{let e;for(let r of t)if(typeof r=="string"){let s=Se(r);(s&&!e||s&&e&&s.length<e.length)&&(e=s)}if(e){let r=e;t=t.map(s=>typeof s=="string"?s.split(`
`).map(a=>(a.startsWith(r)&&(a=a.replace(r,"")),a)).join(`
`):s)}return t};var Y=async t=>await A.new(t),A=class t{#e;#t;static async new(e){let r=await g(e),s,a;if(typeof r=="string")a=r;else if(p.is(r)||f.is(r))a=r.toString();else if(c.is(r))s=r;else if(r instanceof m){i(r.components().length<=2);let[n,l]=r.components();if(typeof n=="string"&&l===void 0)a=n;else if(c.is(n)&&l===void 0)s=n;else if(c.is(n)&&typeof l=="string")s=n,i(l.startsWith("/")),a=l.slice(1);else throw new Error("Invalid template.")}else{if(r instanceof t)return r;if(typeof r=="object"){s=r.artifact;let n=r.path;typeof n=="string"?a=n:f.is(n)&&(a=n.toString())}}let o;return s!==void 0&&a!==void 0?o=await V`${s}/${a}`:s!==void 0&&a===void 0?o=await V`${s}`:s===void 0&&a!==void 0?o=await V`${a}`:o=await V``,t.fromSyscall(oe.new({target:o.toSyscall()}))}constructor(e){this.#e=e.hash,this.#t=e.target}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}toSyscall(){let e=this.#e,r=this.#t.toSyscall();return{hash:e,target:r}}static fromSyscall(e){let r=e.hash,s=m.fromSyscall(e.target);return new t({hash:r,target:s})}hash(){return this.#e}target(){return this.#t}artifact(){let e=this.#t.components().at(0);if(c.is(e))return e}path(){let[e,r]=this.#t.components();if(typeof e=="string"&&r===void 0)return E(e);if(c.is(e)&&r===void 0)return;if(c.is(e)&&typeof r=="string")return E(r.slice(1));throw new Error("Invalid template.")}async resolve(e){e=e?await Y(e):void 0;let r=e?.artifact();r instanceof t&&(r=await r.resolve());let s=e?.path(),a=this.artifact();a instanceof t&&(a=await a.resolve());let o=this.path();if(a!==void 0&&o===void 0)return a;if(a===void 0&&o!==void 0){if(!(r instanceof d))throw new Error("Expected a directory.");return await r.tryGet((s??E()).parent().join(o).toSubpath())}else if(a!==void 0&&o!==void 0){if(!(a instanceof d))throw new Error("Expected a directory.");return await a.tryGet(o.toSubpath())}else throw new Error("Invalid symlink.")}};var b;(o=>(o.is=n=>n===void 0||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Uint8Array||n instanceof p||n instanceof f||n instanceof h||n instanceof d||n instanceof w||n instanceof A||n instanceof x||n instanceof m||n instanceof P||n instanceof Function||n instanceof T||n instanceof Array||typeof n=="object",o.expect=n=>(i((0,o.is)(n)),n),o.assert=n=>{i((0,o.is)(n))},o.toSyscall=n=>n===void 0?{kind:"null"}:typeof n=="boolean"?{kind:"bool",value:n}:typeof n=="number"?{kind:"number",value:n}:typeof n=="string"?{kind:"string",value:n}:n instanceof Uint8Array?{kind:"bytes",value:n}:n instanceof p?{kind:"relpath",value:n.toSyscall()}:n instanceof f?{kind:"subpath",value:n.toSyscall()}:n instanceof h?{kind:"blob",value:n.toSyscall()}:c.is(n)?{kind:"artifact",value:c.toSyscall(n)}:n instanceof x?{kind:"placeholder",value:n.toSyscall()}:n instanceof m?{kind:"template",value:n.toSyscall()}:C.is(n)?{kind:"operation",value:C.toSyscall(n)}:n instanceof Array?{kind:"array",value:n.map(u=>o.toSyscall(u))}:typeof n=="object"?{kind:"object",value:Object.fromEntries(Object.entries(n).map(([u,y])=>[u,o.toSyscall(y)]))}:R(),o.fromSyscall=n=>{switch(n.kind){case"null":return;case"bool":return n.value;case"number":return n.value;case"string":return n.value;case"bytes":return n.value;case"relpath":return p.fromSyscall(n.value);case"subpath":return f.fromSyscall(n.value);case"blob":return h.fromSyscall(n.value);case"artifact":return c.fromSyscall(n.value);case"placeholder":return x.fromSyscall(n.value);case"template":return m.fromSyscall(n.value);case"operation":return C.fromSyscall(n.value);case"array":return n.value.map(l=>o.fromSyscall(l));case"object":return Object.fromEntries(Object.entries(n.value).map(([l,u])=>[l,o.fromSyscall(u)]));default:return R()}}))(b||={});var G={},ce=t=>{i(t.module.kind==="normal");let e=v.fromSyscall(Q.new({packageHash:t.module.value.packageHash,modulePath:t.module.value.modulePath,kind:t.kind??"function",name:t.name,env:{},args:[]}));e.f=t.f;let r=X.encode({module:t.module,name:t.name});return i(G[r]===void 0),G[r]=e,e};var ue=async(t,e,r)=>{M.value=Object.fromEntries(Object.entries(e).map(([n,l])=>[n,b.fromSyscall(l)]));let s=r.map(n=>b.fromSyscall(n)),a=await t(...s);return b.toSyscall(a)},v=class t extends globalThis.Function{f;hash;packageHash;modulePath;kind;name;env;args;static new(e){let r=Object.fromEntries(Object.entries(e.env??{}).map(([o,n])=>[o,b.toSyscall(n)])),s=(e.args??[]).map(o=>b.toSyscall(o)),a=t.fromSyscall(Q.new({packageHash:e.function.packageHash,modulePath:e.function.modulePath.toSyscall(),kind:e.function.kind,name:e.function.name,env:r,args:s}));return a.f=e.function.f,a}constructor(e){return super(),this.f=e.f,this.hash=e.hash,this.packageHash=e.packageHash,this.modulePath=S(e.modulePath),this.kind=e.kind,this.name=e.name,this.env=e.env,this.args=e.args,new Proxy(this,{apply:async(r,s,a)=>{let o=t.new({function:r,args:await Promise.all(a.map(g)),env:M.value}),n=await F.run(C.toSyscall(o));return b.fromSyscall(n)}})}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}toSyscall(){let e=this.hash,r=this.packageHash,s=this.modulePath.toString(),a=this.kind,o=this.name,n=this.env?Object.fromEntries(Object.entries(this.env).map(([u,y])=>[u,b.toSyscall(y)])):void 0,l=this.args?this.args.map(u=>b.toSyscall(u)):void 0;return{hash:e,packageHash:r,modulePath:s,kind:a,name:o,env:n,args:l}}static fromSyscall(e){let r=e.hash,s=e.packageHash,a=e.modulePath,o=e.kind,n=e.name,l=e.env!==void 0?Object.fromEntries(Object.entries(e.env).map(([y,k])=>[y,b.fromSyscall(k)])):void 0,u=e.args!==void 0?e.args.map(y=>b.fromSyscall(y)):void 0;return new t({hash:r,packageHash:s,modulePath:a,kind:o,name:n,env:l,args:u})}};var C;(s=>(s.is=a=>a instanceof P||a instanceof v||a instanceof T,s.toSyscall=a=>a instanceof P?{kind:"command",value:a.toSyscall()}:a instanceof v?{kind:"function",value:a.toSyscall()}:a instanceof T?{kind:"resource",value:a.toSyscall()}:R(),s.fromSyscall=a=>{switch(a.kind){case"command":return P.fromSyscall(a.value);case"function":return v.fromSyscall(a.value);case"resource":return T.fromSyscall(a.value);default:return R()}}))(C||={});var me=async t=>await P.new(t),pe=async t=>await(await P.new(t)).run(),fe=W("output"),P=class t{#e;#t;#r;#n;#s;#a;#o;#l;static async new(e){let r=await g(e),s=r.system,a=await U(r.executable),o=Object.fromEntries(await Promise.all(Object.entries(r.env??{}).map(async([j,J])=>[j,await U(J)]))),n=Object.fromEntries(Object.entries(o).map(([j,J])=>[j,J.toSyscall()])),l=await Promise.all((r.args??[]).map(async j=>(await U(j)).toSyscall())),u=r.checksum??void 0,y=r.unsafe??!1,k=r.network??!1;return t.fromSyscall(te.new({system:s,executable:a.toSyscall(),env:n,args:l,checksum:u,unsafe:y,network:k}))}constructor(e){this.#e=e.hash,this.#t=e.system,this.#r=e.executable,this.#n=e.env,this.#s=e.args,this.#a=e.checksum,this.#o=e.unsafe,this.#l=e.network}toSyscall(){let e=this.#e,r=this.#t,s=this.#r.toSyscall(),a=Object.fromEntries(Object.entries(this.#n).map(([y,k])=>[y,k.toSyscall()])),o=this.#s.map(y=>y.toSyscall()),n=this.#a,l=this.#o,u=this.#l;return{hash:e,system:r,executable:s,env:a,args:o,checksum:n,unsafe:l,network:u}}static fromSyscall(e){let r=e.hash,s=e.system,a=m.fromSyscall(e.executable),o=Object.fromEntries(Object.entries(e.env).map(([k,j])=>[k,m.fromSyscall(j)])),n=e.args.map(k=>m.fromSyscall(k)),l=e.checksum,u=e.unsafe,y=e.network;return new t({hash:r,system:s,executable:a,env:o,args:n,checksum:l,unsafe:u,network:y})}hash(){return this.#e}async run(){let e=await F.run(C.toSyscall(this));return b.fromSyscall(e)}};var g=async t=>{if(t=await t,t===void 0||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Uint8Array||t instanceof p||t instanceof f||t instanceof h||t instanceof d||t instanceof w||t instanceof A||t instanceof x||t instanceof m||t instanceof P||t instanceof Function||t instanceof T)return t;if(t instanceof Array)return await Promise.all(t.map(e=>g(e)));if(typeof t=="object")return Object.fromEntries(await Promise.all(Object.entries(t).map(async([e,r])=>[e,await g(r)])));throw new Error("Invalid value to resolve.")};var I=async t=>await h.new(t),h=class t{#e;static async new(e){let r=await g(e),s;if(r instanceof Uint8Array||typeof r=="string")s=r;else return r;return t.fromSyscall(await K.new(s))}constructor(e){this.#e=e.hash}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}toSyscall(){return{hash:this.#e}}static fromSyscall(e){let r=e.hash;return new t({hash:r})}hash(){return this.#e}async bytes(){return await K.bytes(this.toSyscall())}async text(){return await K.text(this.toSyscall())}};(e=>{let t;(o=>(o.is=n=>n instanceof Uint8Array||typeof n=="string"||n instanceof e,o.expect=n=>(i((0,o.is)(n)),n),o.assert=n=>{i((0,o.is)(n))}))(t=e.Arg||={})})(h||={});var ye=async(...t)=>await d.new(...t),d=class t{#e;#t;static async new(...e){let r={};for(let s of await Promise.all(e.map(g)))if(s!==void 0){if(s instanceof t)for(let[a,o]of Object.entries(await s.entries())){let n=r[a];n instanceof t&&o instanceof t&&(o=await t.new(n,o)),r[a]=o}else if(typeof s=="object")for(let[a,o]of Object.entries(s)){let[n,...l]=S(a).components();if(n===void 0)throw new Error("The path must have at least one component.");let u=n,y=r[u];if(y instanceof t||(y=void 0),l.length>0){let k=S(l).toString(),j=await t.new(y,{[k]:o});r[u]=j}else if(o===void 0)delete r[u];else if(h.Arg.is(o)){let k=await L(o);r[u]=k}else if(w.is(o)||A.is(o))r[u]=o;else{let k=await t.new(y,o);r[u]=k}}}return t.fromSyscall(re.new({entries:Object.fromEntries(Object.entries(r).map(([s,a])=>[s,c.toSyscall(a)]))}))}constructor(e){this.#e=e.hash,this.#t=e.entries}static is(e){return e instanceof t}static expect(e){return i(t.is(e)),e}static assert(e){i(t.is(e))}toSyscall(){return{hash:this.#e,entries:this.#t}}static fromSyscall(e){let r=e.hash,s=e.entries;return new t({hash:r,entries:s})}hash(){return this.#e}async get(e){let r=await this.tryGet(e);return i(r,`Failed to get the directory entry "${e}".`),r}async tryGet(e){let r=this,s=S();e=S(e);for(let a of e.components()){if(!(r instanceof t))return;s.push(a);let o=r.#t[a];if(o===void 0)return;let n=await c.get(o);if(n instanceof A){let l=await n.resolve(V`${this}/${s}`);if(l===void 0)return;r=l}else r=n}return r}async entries(){let e={};for await(let[r,s]of this)e[r]=s;return e}async bundle(){let e=c.fromSyscall(await z.bundle(c.toSyscall(this)));return i(t.is(e)),e}async*walk(){for await(let[e,r]of this)if(yield[S(e),r],t.is(r))for await(let[s,a]of r.walk())yield[S(e).join(s),a]}*[Symbol.iterator](){for(let[e,r]of Object.entries(this.#t))yield[e,r]}async*[Symbol.asyncIterator](){for(let[e,r]of this)yield[e,await c.get(r)]}};var c;(n=>(n.is=l=>l instanceof d||l instanceof w||l instanceof A,n.expect=l=>(i((0,n.is)(l)),l),n.assert=l=>{i((0,n.is)(l))},n.get=async l=>n.fromSyscall(await z.get(l)),n.toSyscall=l=>l instanceof d?{kind:"directory",value:l.toSyscall()}:l instanceof w?{kind:"file",value:l.toSyscall()}:l instanceof A?{kind:"symlink",value:l.toSyscall()}:R(),n.fromSyscall=l=>{switch(l.kind){case"directory":return d.fromSyscall(l.value);case"file":return w.fromSyscall(l.value);case"symlink":return A.fromSyscall(l.value);default:return R()}}))(c||={});var he=(t,e)=>({callSites:e.map(s=>({typeName:s.getTypeName(),functionName:s.getFunctionName(),methodName:s.getMethodName(),fileName:s.getFileName(),lineNumber:s.getLineNumber(),columnNumber:s.getColumnNumber(),isEval:s.isEval(),isNative:s.isNative(),isConstructor:s.isConstructor(),isAsync:s.isAsync(),isPromiseAll:s.isPromiseAll(),promiseIndex:s.getPromiseIndex()}))});var de=async t=>{i(t.module.kind==="normal");let e=await c.get(t.module.value.packageHash);d.assert(e);let r=S(t.module.value.modulePath).toRelpath().parent().join(t.path).toSubpath();return e.get(r)};var Z=(...t)=>{let e=t.map(r=>Pe(r)).join(" ");se(e)},Pe=t=>q(t,new WeakSet),q=(t,e)=>{switch(typeof t){case"string":return`"${t}"`;case"number":return t.toString();case"boolean":return t?"true":"false";case"undefined":return"undefined";case"object":return t===null?"null":Re(t,e);case"function":return`(function "${t.name??"(anonymous)"}")`;case"symbol":return"(symbol)";case"bigint":return t.toString()}},Re=(t,e)=>{if(e.has(t))return"(circular)";if(e.add(t),t instanceof Array)return`[${t.map(r=>q(r,e)).join(", ")}]`;if(t instanceof Error)return t.stack??"";if(t instanceof Promise)return"(promise)";if(t instanceof p)return`(tg.relpath ${t.toString()})`;if(t instanceof f)return`(tg.subpath ${t.toString()})`;if(t instanceof h)return`(tg.blob ${t.hash()})`;if(t instanceof d)return`(tg.directory ${t.hash()})`;if(t instanceof w)return`(tg.file ${t.hash()})`;if(t instanceof A)return`(tg.symlink ${t.hash()})`;if(t instanceof x)return`(tg.placeholder "${t.name()}")`;if(t instanceof m)return`(tg.template "${t.components().map(s=>typeof s=="string"?s:`\${${q(s,e)}}`).join("")}")`;if(t instanceof P)return`(tg.command "${t.hash()}")`;if(t instanceof v)return`(tg.function "${t.hash}")`;if(t instanceof T)return`(tg.resource "${t.hash()}")`;{let r="";t.constructor!==void 0&&t.constructor.name!=="Object"&&(r=`${t.constructor.name} `);let s=Object.entries(t).map(([a,o])=>`${a}: ${q(o,e)}`);return`${r}{ ${s.join(", ")} }`}};var ge=t=>{if(typeof t=="string")return t;{let{arch:e,os:r}=t;return`${e}_${r}`}},ee;(s=>(s.is=a=>a==="amd64_linux"||a==="arm64_linux"||a==="amd64_macos"||a==="arm64_macos",s.arch=a=>{switch(a){case"amd64_linux":case"amd64_macos":return"amd64";case"arm64_linux":case"arm64_macos":return"arm64";default:throw new Error("Invalid system.")}},s.os=a=>{switch(a){case"amd64_linux":case"arm64_linux":return"linux";case"amd64_macos":case"arm64_macos":return"macos";default:throw new Error("Invalid system.")}}))(ee||={});Object.defineProperties(Error,{prepareStackTrace:{value:he}});var Ce={log:Z};Object.defineProperties(globalThis,{console:{value:Ce}});var ve={Artifact:c,Blob:h,Directory:d,File:w,Function:v,Placeholder:x,Relpath:p,Subpath:f,Symlink:A,System:ee,Template:m,Value:b,base64:H,blob:I,command:me,directory:ye,download:ie,entrypoint:ue,env:M,file:L,function:ce,hex:B,include:de,json:D,log:Z,output:fe,placeholder:W,functions:G,relpath:E,resolve:g,resource:le,run:pe,subpath:S,symlink:Y,system:ge,template:U,toml:$,utf8:N,yaml:_};Object.defineProperties(globalThis,{tg:{value:ve},t:{value:V}});})();
//# sourceMappingURL=global.js.map
